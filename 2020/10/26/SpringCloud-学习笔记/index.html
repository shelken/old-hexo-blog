

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.ico">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Shelken Pan">
  <meta name="keywords" content="">
  <title>SpringCloud å­¦ä¹ ç¬”è®° - Shelkenâ€˜s Blogs</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/github-gist.min.css" />
    
  

  


<!-- ä¸»é¢˜ä¾èµ–çš„å›¾æ ‡åº“ï¼Œä¸è¦è‡ªè¡Œä¿®æ”¹ -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- è‡ªå®šä¹‰æ ·å¼ä¿æŒåœ¨æœ€åº•éƒ¨ -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Fluid</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                é¦–é¡µ
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                å½’æ¡£
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                åˆ†ç±»
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                æ ‡ç­¾
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                å…³äº
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2020-10-26 00:56" pubdate>
        2020å¹´10æœˆ26æ—¥ å‡Œæ™¨
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      1.9k å­—
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      23
       åˆ†é’Ÿ
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">SpringCloud å­¦ä¹ ç¬”è®°</h1>
            
            <div class="markdown-body" id="post-body">
              <h1 id="å‰æœŸé…ç½®"><a href="#å‰æœŸé…ç½®" class="headerlink" title="å‰æœŸé…ç½®"></a>å‰æœŸé…ç½®</h1><p>###å¤§æ¦‚</p>
<p>åˆ›ä¸€ä¸ªä¸»é…ç½® pomï¼Œè®©å­ pom æ¥ç»§æ‰¿ä¸» pomã€‚æ‰€æœ‰å­æ¨¡å—ç»§æ‰¿</p>
<p>ç»ƒæ‰‹ï¼šæ”¯ä»˜æ¨¡å— 8001 ä¸è®¢å•æ¨¡å— 80ï¼Œ80ç”¨ restTemplate æ¥è°ƒç”¨ 8001 ä¸­çš„æœåŠ¡ï¼Œ</p>
<p>é¡¹ç›®åˆ›å»ºæµç¨‹ï¼š</p>
<ol>
<li>åˆ›å»º module ï¼Œ</li>
<li>ä¿®æ”¹ pom æ–‡ä»¶ï¼Œå¼•å…¥æ‰€éœ€è¦çš„ä¾èµ–ã€‚</li>
<li>å†™é…ç½®æ–‡ä»¶ yaml</li>
<li>åŠ å…¥ä¸»å¯åŠ¨ main æ–¹æ³•</li>
<li>è¿›è¡Œä¸šåŠ¡ä»£ç ç¼–å†™ï¼ˆControllerï¼Œdaoï¼Œbeanï¼Œserviceç­‰ï¼‰</li>
</ol>
<h3 id="å·¥ç¨‹é‡æ„"><a href="#å·¥ç¨‹é‡æ„" class="headerlink" title="å·¥ç¨‹é‡æ„"></a>å·¥ç¨‹é‡æ„</h3><p>å°†é‡å¤çš„ä»£ç é‡æ„ï¼ˆå°±æ˜¯å°†ä»£ç åˆ†ç¦»é‡æ–°å»ºä¸ªé€šç”¨çš„å­é¡¹ç›®ï¼Œè®©å…¶ä»–é¡¹ç›®å¼•ç”¨ä¾èµ–ï¼‰</p>
<h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol>
<li>æœ‰ä¸€ä¸ªåœ°æ–¹éœ€è¦æ³¨æ„ï¼Œ@requestBody è¿™ä¸ªæ³¨è§£æ¥å—çš„æ˜¯ jsonï¼Œæ‰€ä»¥å†™params ä¼šæ— æ•ˆçš„ï¼Œå¾—å‘é€ jsonã€‚</li>
<li>datasource é‡Œçš„æ•°æ®åº“å¯†ç å¦‚æœå…¨æ•°å­—éœ€è¦åŠ åŒå¼•å·</li>
<li>mabatis éƒ¨åˆ†çŸ¥è¯†ç‚¹ï¼š<ol>
<li>insert ï¼Œidï¼ŒparameterTypeï¼ˆDAO ä¸­å‚æ•°çš„ç±»å‹ï¼‰,useGeneratedKeysï¼ˆä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆï¼‰,keyPropertyï¼ˆä¸»é”®ï¼‰ã€‹</li>
<li>resultMap ï¼Œid,typeã€‹id columnï¼ˆè¡¨å­—æ®µï¼‰ï¼Œpropertyï¼ˆå¯¹è±¡çš„å±æ€§ï¼‰ï¼ŒjdbcTypeã€‹</li>
<li>selectï¼ŒresultMapï¼ˆæŒ‡å®šæ˜ å°„çš„ resultMapï¼‰ã€‹</li>
</ol>
</li>
</ol>
<h1 id="EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"><a href="#EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°" class="headerlink" title="EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°"></a>EurekaæœåŠ¡æ³¨å†Œä¸å‘ç°</h1><p>ç‰¹ç‚¹ï¼šé›†ç¾¤ï¼Œé«˜å¯ç”¨ï¼Œ</p>
<p>æœåŠ¡æ³¨å†Œä¸æœåŠ¡å‘ç°ï¼Œå®¢æˆ·ç«¯éœ€è¦é€šè¿‡æœåŠ¡æ³¨å†Œæ³¨å†Œåˆ°æœåŠ¡ç«¯ä¸­ï¼Œéœ€è¦é€šè¿‡æœåŠ¡å‘ç°è·å–å…¶ä»–æœåŠ¡çš„åœ°å€ã€‚æä¾›è€…æä¾›æœåŠ¡ï¼Œæ¶ˆè´¹è€…æ¶ˆè´¹æœåŠ¡ã€‚æ¶ˆè´¹è€…é€šè¿‡è¿œç¨‹è°ƒç”¨æœåŠ¡ã€‚å®¢æˆ·ç«¯é»˜è®¤ 30 ç§’æ›´æ–°ä¸€æ¬¡å…¶ä»–æœåŠ¡çš„åœ°å€</p>
<p>é›†ç¾¤æ³¨å†ŒåŸç†ï¼šäº’ç›¸æ³¨å†Œï¼Œç›¸äº’å®ˆæœ›ã€‚</p>
<p>å®æ“ï¼šå…±æœ‰ä¸¤ä¸ª eureka æœåŠ¡ç«¯ï¼Œä¸¤ä¸ª provider å®¢æˆ·ç«¯ï¼Œä¸€ä¸ªconsumer å®¢æˆ·ç«¯ã€‚</p>
<p>å°†ä¸¤ä¸ª eureka æœåŠ¡ç«¯ä¸¤ä¸¤æ³¨å†Œï¼Œ7001ï¼Œ7002 ã€‚yaml æ”¹ç«¯å£ï¼Œæ”¹ hostnameï¼Œä¿®æ”¹defaultZoneä¸ºå…¶ä»–çš„ server</p>
<p>ç„¶åä¿®æ”¹æ‰€æœ‰å®¢æˆ·ç«¯ï¼Œç›¸åŒçš„provider å…±äº«ç›¸åŒçš„application åå­—ï¼Œå¯¹äº defaultZoneï¼Œprovider éœ€è¦æŒ‡å®š eureka serverçš„åœ°å€ã€‚</p>
<p>ä¾‹å¦‚ï¼š<a target="_blank" rel="noopener" href="http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka">http://eureka7001.com:7001/eureka,http://eureka7002.com:7002/eureka</a></p>
<p>å¯¹äº consumer ç«¯ï¼Œåœ¨ restTemplate é‡Œéœ€è¦å¼€å¯è´Ÿè½½å‡è¡¡åŠŸèƒ½æ‰èƒ½ä½¿ç”¨ä»¥ä¸‹æ ¼å¼çš„æ–¹å¼æ‹‰è®¿é—®æœåŠ¡ï¼šåªéœ€è¦çŸ¥é“ application name å°±è¡Œï¼Œå‰©ä¸‹çš„ä¸»æœºå’Œç«¯å£è®© eureka æ¥åˆ†é…ã€‚</p>
<p><img src="https://i.loli.net/2020/10/19/FjGlmgOQ1hcsXIb.png" srcset="/img/loading.gif" alt="image-20201019133520495"></p>
<p><img src="https://i.loli.net/2020/10/19/v5OLhTClRQasd9w.png" srcset="/img/loading.gif" alt="image-20201019133816299"></p>
<ul>
<li>å…³é—­eureka è‡ªæˆ‘ä¿æŠ¤ ï¼Œåœ¨æœåŠ¡ç«¯é…ç½®å†™ä¸Šeureka.server.enbale-self-preservation=falseå¯ä»¥ç¦æ­¢è‡ªæˆ‘ä¿æŠ¤</li>
<li><strong>enable-self-preservation</strong> : <strong>false    eviction-interval-timer-in-ms</strong> : 2000 ï¼ˆæ¸…é™¤é—´éš”æ—¶é—´ï¼‰</li>
</ul>
<pre><code class="hljs yaml"><span class="hljs-attr">lease-renewal-interval-in-seconds:</span> <span class="hljs-number">1</span> <span class="hljs-comment">#å¿ƒè·³æ—¶é—´</span>
<span class="hljs-attr">lease-expiration-duration-in-seconds:</span> <span class="hljs-number">2</span> <span class="hljs-comment">#æ‰çº¿æ¸…é™¤æ—¶é—´</span></code></pre>

<h1 id="Zookper"><a href="#Zookper" class="headerlink" title="Zookper"></a>Zookper</h1><p>ç‰ˆæœ¬ï¼š3.4.9</p>
<ol>
<li>åŠ å…¥ spring-cloud-starter-zookeeper-discovery åŒ…ï¼Œæ’é™¤æ‰ 3.5.3çš„åŒ…ï¼Œé‡æ–°åŠ å…¥ 3.4.9ã€‚</li>
<li><img src="https://i.loli.net/2020/10/20/hBUFg9TeysOzvGl.png" srcset="/img/loading.gif" alt="image-20201020092817749"></li>
</ol>
<p>è¿æ¥åˆ° zookeeperã€‚</p>
<ol start="3">
<li>ä¸»ç¨‹åºåŠ å…¥@EnableDiscoveryClient æ³¨è§£</li>
<li>è¿æ¥åˆ°<img src="https://i.loli.net/2020/10/20/OfqJWwIHG3zhDLY.png" srcset="/img/loading.gif" alt="image-20201020093200489"></li>
</ol>
<p>zookeeper éµå¾ª cap ä¸­çš„ cpã€‚eureka éµå¾ª apã€‚</p>
<p>zookeeper ä¼šç›´æ¥ç§»é™¤æ²¡ç”¨çš„èŠ‚ç‚¹ã€‚</p>
<h1 id="Consul"><a href="#Consul" class="headerlink" title="Consul"></a>Consul</h1><p>å·®ä¸å¤šè·Ÿä¸Šé¢ä¸€æ ·</p>
<h1 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h1><p>å±äºè¿›ç¨‹å†…è´Ÿè½½å‡è¡¡ï¼Œä¸é›†ä¸­å¼è´Ÿè½½å‡è¡¡ä¸åŒã€‚å®¢æˆ·ç«¯ä»æœåŠ¡ç«¯å‘ç°å…¶ä»–çš„æœåŠ¡ ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªåˆé€‚çš„æœåŠ¡å™¨ã€‚</p>
<p><img src="https://i.loli.net/2020/10/20/4tKuhdq2f6ZTxi3.png" srcset="/img/loading.gif" alt="image-20201020202238955"></p>
<p>è´Ÿè½½å‡è¡¡ä¸ƒç§ç®—æ³•ã€‚</p>
<p><img src="https://i.loli.net/2020/10/20/MpyrzncGlgVwsTo.png" srcset="/img/loading.gif" alt="image-20201020202828184"></p>
<p>xxxforObject ä¸ xxxforEntity åŒºåˆ«åœ¨äºï¼Œå‰è€…åªè·å¾—ä¸€ä¸ªå¯¹è±¡ä¿¡æ¯ï¼Œåè€…è·å¾—åŒ…æ‹¬è¿”å›çš„å¯¹è±¡ä»¥åŠä¸€äº›çŠ¶æ€ä¿¡æ¯ï¼Œä¾‹å¦‚ headerï¼Œstatusç­‰ã€‚</p>
<ul>
<li>æ³¨æ„ç‚¹ï¼š</li>
<li>ribbon æŒ‡å®šå…¶ä»–çš„ Irule æ—¶å€™ï¼Œæ³¨è§£é‡Œçš„RibbonClientçš„ name å¿…é¡»å’Œè°ƒç”¨è¿™ä¸ªæœåŠ¡çš„åç§°å¿…é¡»ä¸€è‡´ï¼Œå¤§å°å†™æ•æ„Ÿã€‚ä¾‹å¦‚åœ¨ ordercontroller é‡Œä½¿ç”¨åˆ°è¿™ä¸ªæœåŠ¡æ—¶ã€‚</li>
<li><img src="https://i.loli.net/2020/10/20/c4oWZtGFSCRM27z.png" srcset="/img/loading.gif" alt="image-20201020210345442"></li>
</ul>
<pre><code class="hljs java"><span class="hljs-comment">//æ›¿æ¢æ‰é»˜è®¤çš„è½®è¯¢ç®—æ³•ã€‚</span>
<span class="hljs-meta">@RibbonClient</span> ( nameÂ  =Â  <span class="hljs-string">&quot;CLOUD-PAYMENT-SERVICE&quot;</span> , configurationÂ  = MySelfRule. <span class="hljs-class"><span class="hljs-keyword">class</span> </span></code></pre>



<p>æ‰‹å†™ä¸€ä¸ª ribbon çš„è´Ÿè½½å‡è¡¡ç®—æ³•ã€‚</p>
<h1 id="OpenFeign"><a href="#OpenFeign" class="headerlink" title="OpenFeign"></a>OpenFeign</h1><p>å¼€å¯ feign</p>
<p><img src="https://i.loli.net/2020/10/26/m7DLKpd2vTk9wZG.png" srcset="/img/loading.gif" alt="image-20201021170058363"></p>
<p>ç„¶åå°†æä¾›è€…çš„ api ä¸æˆ‘ä»¬çš„æ¥å£å¯¹åº”ã€‚feign å¸®æˆ‘ä»¬å®Œæˆç±»ä¼¼äº resttemplat çš„å·¥ä½œï¼Œå¹¶ä¸”å®ç°è´Ÿè½½å‡è¡¡</p>
<p><img src="https://i.loli.net/2020/10/26/fXYzT9JHPt7yUV4.png" srcset="/img/loading.gif" alt="image-20201021170421029"></p>
<p>è¿™é‡Œæ˜¯æ§åˆ¶ç±»ï¼Œå®ç°ç”¨æˆ·æ¥å£è°ƒç”¨ã€‚</p>
<p><img src="https://i.loli.net/2020/10/21/bzI2G1YB79gnUZM.png" srcset="/img/loading.gif" alt="image-20201021170624755"></p>
<p>feignè¯¦ç»†æ—¥å¿—ï¼š</p>
<p><img src="https://i.loli.net/2020/10/21/sbAQcuJ8tU1YmEx.png" srcset="/img/loading.gif" alt="image-20201021172104947"></p>
<p><img src="https://i.loli.net/2020/10/26/aq4UET3Bf5i2tAw.png" srcset="/img/loading.gif" alt="image-20201021172118163"></p>
<h1 id="Hystrix-æ–­è·¯å™¨-é™çº§-å®æ—¶ç›‘è§†"><a href="#Hystrix-æ–­è·¯å™¨-é™çº§-å®æ—¶ç›‘è§†" class="headerlink" title="Hystrix æ–­è·¯å™¨ é™çº§ å®æ—¶ç›‘è§†"></a>Hystrix æ–­è·¯å™¨ é™çº§ å®æ—¶ç›‘è§†</h1><p>å¦‚æœä¸€ä¸ªæœåŠ¡è¶…æ—¶äº†æˆ–è€…å‡ºé”™ç­‰åŸå› å¯¼è‡´æ¶ˆè´¹ç«¯å‡ºç°ç­‰å¾…æƒ…å†µï¼Œåº”è¯¥æœåŠ¡é™çº§ï¼Œåº”è¿”å›ç”¨æˆ·ä¸€ä¸ªå¤‡é€‰æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯æŒç»­è¿æ¥å ç”¨èµ„æºå’Œæµªè´¹æ¶ˆè´¹ç«¯æ—¶é—´ã€‚è¿”å›ä¸€äº›æ›´å‹å¥½çš„æç¤ºã€‚</p>
<p><img src="https://i.loli.net/2020/10/26/JjKA85H9LV2PzT1.png" srcset="/img/loading.gif" alt="image-20201022004743699"></p>
<p><img src="https://i.loli.net/2020/10/22/w8xfdjyZBpgKnoA.png" srcset="/img/loading.gif" alt="image-20201022004642186"></p>
<p>åœ¨æœåŠ¡ç«¯å¼€å¯æœåŠ¡é™çº§ï¼Œåœ¨å®¢æˆ·ç«¯å¼€å¯æœåŠ¡é™çº§ã€‚</p>
<p><img src="https://i.loli.net/2020/10/22/G8kWiz2V4HOtQMn.png" srcset="/img/loading.gif" alt="image-20201022193017683"></p>
<p>é€šè¿‡ä¸€ä¸ªå…¨å±€æ³¨è§£æ¥é…ç½®ä¸€ä¸ªæ–¹æ³•ä½œä¸ºæ‰€æœ‰å‡ºç°é—®é¢˜çš„fallbackï¼Œè¿™ä¸ªé‡Œé¢çš„é…ç½®éƒ½æ˜¯é»˜è®¤å€¼ã€‚</p>
<p>ä¹Ÿå¯ä»¥å®ç°ä¸€ä¸ªæœåŠ¡çš„æ¥å£ï¼Œç„¶åç”¨ openfeign çš„ fallback æ¥å®ç°ï¼Œå¤šä¸ªæ–¹æ³•å¯¹åº”å¤šä¸ªä¸åŒé™çº§ã€‚</p>
<p><img src="https://i.loli.net/2020/10/22/ribLAB85x6OyCRt.png" srcset="/img/loading.gif" alt="image-20201022193445110"></p>
<p>æœåŠ¡ç†”æ–­ï¼š</p>
<p><img src="https://i.loli.net/2020/10/26/vb3kDOexNs5BXyG.png" srcset="/img/loading.gif" alt="image-20201022193800408"></p>
<p><img src="https://i.loli.net/2020/10/22/NbokR7xK25ZIcmE.png" srcset="/img/loading.gif" alt="image-20201022224757930"></p>
<p>å¯ä»¥å†é…ç½®é‡ŒæŒ‡å®šæŸä¸ªæœåŠ¡æŸä¸ªæ–¹æ³• hystrix çš„é…ç½®ã€‚</p>
<p>æœåŠ¡é™æµï¼šé˜¿é‡Œå·´å·´é‚£è¾¹è®²</p>
<p>#ç½‘å…³gateway</p>
<ul>
<li>è·¯ç”±ï¼š</li>
</ul>
<p><img src="https://i.loli.net/2020/10/23/mLMxVaujwU8oNCp.png" srcset="/img/loading.gif" alt="image-20201023111120322"></p>
<p><img src="https://i.loli.net/2020/10/24/7YXJQLjwdrCA9ai.png" srcset="/img/loading.gif" alt="image-20201024000456024"></p>
<p><img src="https://i.loli.net/2020/10/23/pmSP3BvxahIoWlV.png" srcset="/img/loading.gif" alt="image-20201023112044574"></p>
<ul>
<li><p>æ–­è¨€predicate</p>
<p><img src="https://i.loli.net/2020/10/24/OIznK76PtpyAqgR.png" srcset="/img/loading.gif" alt="image-20201024000211408"></p>
</li>
<li><p>è¿‡æ»¤å™¨</p>
</li>
</ul>
<p>gatewayä¸ globalgateway</p>
<h1 id="SpringCloud-Config"><a href="#SpringCloud-Config" class="headerlink" title="SpringCloud Config"></a>SpringCloud Config</h1><p><img src="https://i.loli.net/2020/10/24/CQgITGWYp3slayd.png" srcset="/img/loading.gif" alt="image-20201024185659784"></p>
<p>å®¢æˆ·ç«¯é…ç½® åŠ¨æ€åˆ·æ–°ï¼š</p>
<p>å‘é€ post åˆ°/actuator/refreshã€‚å°†@RefreshScope æ›´æ–°ã€‚å‰ææ˜¯æœ‰ actuator</p>
<h1 id="æ¶ˆæ¯æ€»çº¿-SpringCloud-Bus"><a href="#æ¶ˆæ¯æ€»çº¿-SpringCloud-Bus" class="headerlink" title="æ¶ˆæ¯æ€»çº¿ SpringCloud Bus"></a>æ¶ˆæ¯æ€»çº¿ SpringCloud Bus</h1><p>é€šè¿‡ post æ–¹å¼åˆ·æ–° config-server çš„æ–¹å¼åŒæ—¶åˆ·æ–°å…¶ä»–çš„ clientã€‚ç”¨äº† rabbitmqçš„åŸç†</p>
<p>bus åœ¨é…ç½®çš„æ—¶å€™åº”æ³¨æ„ï¼Œå®¢æˆ·ç«¯åº”è¯¥åœ¨ boostrap é‡Œé¢æ¥è¿æ¥ server ç«¯ã€‚ç”¨åˆ°ä»¥ä¸‹é…ç½®ï¼š</p>
<p>bootstrap.yaml:</p>
<p><img src="https://i.loli.net/2020/10/25/TgdyVArUtwIi8hW.png" srcset="/img/loading.gif" alt="bootstrap.yaml"></p>
<p><img src="https://i.loli.net/2020/10/25/oyajbuNFxUmBIis.png" srcset="/img/loading.gif" alt="image-20201025020833709"></p>
<p>labelåˆ†æ”¯ï¼Œnameå¯ä»¥ä¸ºå½“å‰æœåŠ¡åï¼Œprofile ä¸ºâ€œ-â€åé¢çš„å­—ç¬¦ï¼Œä¸€èˆ¬ä¸º dev,prodç­‰ç»„æˆã€‚æ ¹æ®å®é™…é…ç½®å¯ä»¥æ›´æ”¹ã€‚</p>
<h1 id="Nacos"><a href="#Nacos" class="headerlink" title="Nacos"></a>Nacos</h1><p>##æ¶æ„</p>
<p><img src="https://i.loli.net/2020/10/28/poZLxnvUSGJ1yT6.jpg" srcset="/img/loading.gif" alt="nacos_data_model"></p>
<p><img src="https://i.loli.net/2020/10/28/NPBE4pbx7tYyVOu.jpg" srcset="/img/loading.gif" alt="nacos_naming_data_model"></p>
<p><img src="https://i.loli.net/2020/10/27/qhn7z9aT5JRrXtM.png" srcset="/img/loading.gif" alt="image-20201027031151017"></p>
<p><img src="https://i.loli.net/2020/10/27/oyHtLEOfhiNx6Dq.png" srcset="/img/loading.gif" alt="image-20201027031542587"></p>
<h2 id="é›†ç¾¤éƒ¨ç½²å£°æ˜"><a href="#é›†ç¾¤éƒ¨ç½²å£°æ˜" class="headerlink" title="é›†ç¾¤éƒ¨ç½²å£°æ˜"></a>é›†ç¾¤éƒ¨ç½²å£°æ˜</h2><p><a target="_blank" rel="noopener" href="https://nacos.io/zh-cn/docs/cluster-mode-quick-start.html">å®˜æ–¹æ•™ç¨‹</a></p>
<p><img src="https://i.loli.net/2020/10/28/RUvJ6OCmHcaLMb1.jpg" srcset="/img/loading.gif" alt="deployDnsVipMode.jpg"></p>
<p><strong>è¿™é‡Œçš„ VIP ç”¨ nginx å®ç°</strong></p>
<h3 id="é…ç½®å¤šé›†ç¾¤-nacos"><a href="#é…ç½®å¤šé›†ç¾¤-nacos" class="headerlink" title="é…ç½®å¤šé›†ç¾¤ nacos"></a>é…ç½®å¤šé›†ç¾¤ nacos</h3><p>æ•™è®­ï¼šæäº†å¥½ä¹…çš„ docker ä½†æ˜¯ä¸€ç›´å¤±è´¥ï¼Œç´¢æ€§æ”¾å¼ƒã€‚ä¸çŸ¥ä¸ºä½•nacos æ€»æ˜¯æ‰¾ä¸åˆ°æ•°æ®åº“ã€‚</p>
<h4 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol>
<li><p>ä¸‹è½½ nacos-server1.1.4 , è§£å‹ã€‚ </p>
</li>
<li><p>ä¿®æ”¹ application.propertities</p>
<p><img src="https://i.loli.net/2020/10/28/R2SkEHOxAW9JPm1.png" srcset="/img/loading.gif" alt="image-20201028222405820"></p>
</li>
</ol>
<pre><code class="hljs properties"><span class="hljs-meta">spring.datasource.platform</span>=<span class="hljs-string">mysql  #æŒ‡å®šå¹³å°ï¼Œè€Œä¸æ˜¯ç”¨å†…ç½® derby</span>
<span class="hljs-meta">db.num</span>=<span class="hljs-string">1 													#æ•°æ®åº“ä¸ªæ•°</span>
<span class="hljs-meta">db.url.0</span>=<span class="hljs-string">jdbc:mysql://127.0.0.1:3306/nacos_devtest?characterEncoding=utf8   #æ•°æ®åº“uri</span>
<span class="hljs-meta">db.user</span>=<span class="hljs-string">root													</span>
<span class="hljs-meta">db.password</span>=<span class="hljs-string">123456</span></code></pre>

<ol start="3">
<li><p>ä¿®æ”¹ startup.sh ï¼ˆè®©å…¶æ”¯æŒè‡ªå®šä¹‰ portï¼Œæ‰èƒ½åœ¨ä¸€ä¸ªæœºå™¨ä¸Šæ¨¡æ‹Ÿï¼‰</p>
<p><img src="https://i.loli.net/2020/10/28/QrmoFe1MDPZOuhK.png" srcset="/img/loading.gif" alt="image-20201028223800541"></p>
<p><img src="https://i.loli.net/2020/10/28/9W5baxVGnTJRde8.png" srcset="/img/loading.gif" alt="image-20201028224141056"></p>
<pre><code class="hljs ba">åŸç†ä¹Ÿå¾ˆç®€å•ï¼ŒåŠ å…¥å‚æ•°ä¹‹åç›´æ¥å‚æ•°å¯åŠ¨ã€‚</code></pre>



</li>
</ol>
<ol start="4">
<li><p>ä¿®æ”¹ cluster.conf æ–‡ä»¶</p>
<pre><code class="hljs pro">192.168.6.2:8848
192.168.6.2:8849
192.168.6.2:8850
</code></pre>

<p>åŠ å…¥å°†è¦å¯åŠ¨çš„nacosé›†ç¾¤çš„ urlã€‚</p>
<p>ç›´æ¥å¯åŠ¨è¿æ¥åˆ° mysqlï¼ŒæˆåŠŸè¿æ¥ï¼ˆå¯åŠ¨å‰è®°å¾—åˆå§‹åŒ–mysql é‡Œçš„æ•°æ®åº“ï¼‰</p>
<p>ä¹‹åé…ç½®å°±å¯ä»¥æŒä¹…åŒ–åˆ°æˆ‘ä»¬ mysql æ•°æ®åº“ã€‚</p>
</li>
</ol>
<p>###é…ç½® nginx</p>
<ol>
<li><pre><code>upstream cluster&#123;
        # server 192.168.6.2:8848;
        # server 192.168.6.2:8848;
        # server 192.168.6.2:8848;
        server 172.20.10.3:8848;
        server 172.20.10.3:8849;
        server 172.20.10.3:8850;
    &#125;

    server &#123;
        listen       1111;
        server_name  localhost;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / &#123;
            # root   html;
            # index  index.html index.htm;
            proxy_pass http://cluster;
        &#125;&#125;
<pre><code class="hljs yaml">
<span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">å¯åŠ¨</span> <span class="hljs-string">nginxï¼Œå®Œæˆè½¬å‘ï¼Œè´Ÿè½½å‡è¡¡ã€‚</span>

<span class="hljs-comment">### ä¿®æ”¹ provider æœåŠ¡çš„é…ç½®</span>

<span class="hljs-string">```yaml</span>
<span class="hljs-attr">server:</span>
  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span>

<span class="hljs-attr">spring:</span>
  <span class="hljs-attr">profiles:</span>
    <span class="hljs-attr">active:</span> <span class="hljs-string">test</span>
  <span class="hljs-attr">application:</span>
    <span class="hljs-attr">name:</span> <span class="hljs-string">nacos-provider-payment</span>
  <span class="hljs-attr">cloud:</span>
    <span class="hljs-attr">nacos:</span>
      <span class="hljs-attr">discovery:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:1111</span>
      <span class="hljs-attr">config:</span>
        <span class="hljs-attr">server-addr:</span> <span class="hljs-string">localhost:1111</span>
        <span class="hljs-attr">file-extension:</span> <span class="hljs-string">yaml</span></code></pre>
</code></pre>
</li>
</ol>
<p><strong>ä¿®æ”¹ server-addr å°†å…¶æŒ‡å‘ nginx åœ°å€</strong></p>
<h1 id="Sentinel-ç†”æ–­ä¸é™æµ"><a href="#Sentinel-ç†”æ–­ä¸é™æµ" class="headerlink" title="Sentinel ç†”æ–­ä¸é™æµ"></a>Sentinel ç†”æ–­ä¸é™æµ</h1><h2 id="æ§åˆ¶å°"><a href="#æ§åˆ¶å°" class="headerlink" title="æ§åˆ¶å°"></a>æ§åˆ¶å°</h2><ol>
<li>ä¸‹è½½ github å®˜æ–¹ sentinel dashboardã€‚<a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/releases">é“¾æ¥</a></li>
<li>ä½¿ç”¨å‘½ä»¤è¿è¡Œ jar åŒ…</li>
</ol>
<pre><code class="hljs bash">java -Dserver.port=2222 -jar xxx.jar</code></pre>

<ol start="3">
<li>ç™»å½•æ§åˆ¶å°</li>
</ol>
<h2 id="é¡¹ç›®è¿æ¥é…ç½®"><a href="#é¡¹ç›®è¿æ¥é…ç½®" class="headerlink" title="é¡¹ç›®è¿æ¥é…ç½®"></a>é¡¹ç›®è¿æ¥é…ç½®</h2><ol>
<li><pre><code class="yaml">spring:
  application:
    name: sentinel-service
  cloud:
    nacos:
      discovery:
        server-addr: localhost:1111
#      config:
#        server-addr: localhost:1111
    sentinel:
      transport:
        dashboard: localhost:2222
        port: 8719
#æŒ‡å®šçš„ç«¯å£å·spring.cloud.sentinel.transport.portå°†åœ¨åº”ç”¨ç¨‹åºçš„ç›¸åº”æœåŠ¡å™¨ä¸Šå¯åŠ¨HTTP Serverï¼Œå¹¶ä¸”è¯¥æœåŠ¡å™¨å°†ä¸Sentinelä»ªè¡¨æ¿è¿›è¡Œäº¤äº’ã€‚ä¾‹å¦‚ï¼Œå¦‚æœåœ¨Sentinelä»ªè¡¨æ¿ä¸­æ·»åŠ äº†é€Ÿç‡é™åˆ¶è§„åˆ™ï¼Œåˆ™è§„åˆ™æ•°æ®å°†è¢«æ¨é€åˆ°HTTP Serverå¹¶ç”±HTTP Serveræ¥æ”¶ï¼Œç„¶åHTTP Serverå°†è§„åˆ™æ³¨å†Œåˆ°Sentinelã€‚        
<pre><code class="hljs xml">
   ä¸Šé¢ğŸ‘†é…ç½®äº† `nacos` å’Œ `sentinel` è¿æ¥çš„åœ°å€

```xml
				<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-sentinel<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span></code></pre>
</code></pre>
</li>
</ol>
<p>ğŸ‘†é…ç½®äº† pom</p>
<ol start="2">
<li>åœ¨å›¾ä¸­çœ‹åˆ°æˆ‘ä»¬çš„å®æ—¶ç›‘æ§å’Œé“¾è·¯å›¾</li>
</ol>
<p>   <img src="https://i.loli.net/2020/10/29/ZT4RbBDQuFgwoPJ.png" srcset="/img/loading.gif" alt="image-20201029211853347"></p>
<h2 id="æµæ§è§„åˆ™"><a href="#æµæ§è§„åˆ™" class="headerlink" title="æµæ§è§„åˆ™"></a>æµæ§è§„åˆ™</h2><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lzb348110175/article/details/107532937">æµæ§è§„åˆ™è¯¦ç»†</a></p>
<h2 id="ç†”æ–­è§„åˆ™"><a href="#ç†”æ–­è§„åˆ™" class="headerlink" title="ç†”æ–­è§„åˆ™"></a>ç†”æ–­è§„åˆ™</h2><p>æ³¨æ„ï¼šsentinel æ— åŠå¼€çŠ¶æ€ã€‚(æœ€æ–° 1.8è¯´æœ‰äº† <a target="_blank" rel="noopener" href="https://github.com/alibaba/Sentinel/wiki/%E7%86%94%E6%96%AD%E9%99%8D%E7%BA%A7#%E9%99%8D%E7%BA%A7%E7%AD%96%E7%95%A5">æŸ¥çœ‹</a>)</p>
<p><img src="https://i.loli.net/2020/10/30/AQpIoKjrwMzlDBe.png" srcset="/img/loading.gif" alt="image-20201030140905203"></p>
<p>ä¾ç„¶æŸ¥çœ‹è¿™ä¸ª<a target="_blank" rel="noopener" href="https://blog.csdn.net/lzb348110175/article/details/107532937">ç†”æ–­è¯¦ç»†</a></p>
<p>##çƒ­ç‚¹è§„åˆ™</p>
<p><img src="https://i.loli.net/2020/10/30/TIbK1gNsVwSHr2D.png" srcset="/img/loading.gif" alt="image-20201030232651118"></p>
<p><img src="https://i.loli.net/2020/10/30/WMh2jFoTJkgOiqN.png" srcset="/img/loading.gif" alt="image-20201030232734395"></p>
<p>å½“å¸¦æœ‰æ­¤å‚æ•°æ—¶ä¼šæœ‰é™æµæ•ˆæœï¼Œæ²¡æœ‰åˆ™æ— ã€‚</p>
<p>fallbackä¸ blockhandler åŒºåˆ«ï¼šä¸€ä¸ªæ˜¯å¤„ç†é™¤äº† blockexceptionçš„é”™è¯¯ï¼Œå¦ä¸€ä¸ªæ˜¯å¤„ç†å…¶ä»–é”™è¯¯ã€‚</p>
<p><img src="https://i.loli.net/2020/10/31/j4rOcBhA3X2Nq9Z.png" srcset="/img/loading.gif" alt="image-20201031024910898"></p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/Spring-Cloud/">Spring Cloud</a>
                    
                      <a class="hover-with-bg" href="/tags/Eureka/">Eureka</a>
                    
                      <a class="hover-with-bg" href="/tags/Zookeeper/">Zookeeper</a>
                    
                      <a class="hover-with-bg" href="/tags/Ribbon/">Ribbon</a>
                    
                      <a class="hover-with-bg" href="/tags/OpenFeign/">OpenFeign</a>
                    
                      <a class="hover-with-bg" href="/tags/Hystrix/">Hystrix</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 åè®®</a> ï¼Œè½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/10/27/%E5%8D%81%E5%A4%A7%E7%BB%8F%E5%85%B8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%EF%BC%88%E5%8A%A8%E5%9B%BE%E6%BC%94%E7%A4%BA%EF%BC%89/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">åå¤§ç»å…¸æ’åºç®—æ³•ï¼ˆåŠ¨å›¾æ¼”ç¤ºï¼‰</span>
                        <span class="visible-mobile">ä¸Šä¸€ç¯‡</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/10/25/java%E5%9F%BA%E7%A1%80%E9%87%8D%E7%82%B9/">
                        <span class="hidden-mobile">javaåŸºç¡€é‡ç‚¹</span>
                        <span class="visible-mobile">ä¸‹ä¸€ç¯‡</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;ç›®å½•</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">æœç´¢</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">å…³é”®è¯</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "SpringCloud å­¦ä¹ ç¬”è®°&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>















</body>
</html>
